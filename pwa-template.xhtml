<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">

<head>
    <title>Accessible PuzzleScript Games</title>
    <link rel="stylesheet" href="./style.css"/>
    <style>
        /* Hide by default */
        .ui-pwa-only { display: none; }
        /* Progressive Web App (PWA) media query. 
         * See https://stackoverflow.com/a/52695341
         * See https://developer.mozilla.org/en-US/docs/Web/CSS/@media/display-mode
         */
        @media all and (display-mode: standalone) {
            .ui-pwa-disabled { display: none; }
            .ui-pwa-only { display: block; }
        }

        /* Show instructions depending on whether the user has a keyboard, touch screen, or both */
        /* https://stackoverflow.com/a/52854585 */
        #touchInstructionsSection { opacity: 0.25; }
        @media (any-pointer: coarse) {
            #touchInstructionsSection { opacity: 1; }
            #keyboardInstructionsSection { display: none; }
        }        

        body {
            margin: 0;
            font-size: 12px;
            font-family: helvetica, arial, sans-serif; 
        }
        body[data-mode="playingGame"] #browseGamesRoot { display: none; }
        body:not([data-mode="playingGame"]) #playGameRoot { display: none; }

        .hidden { display: none !important; }

        kbd {
            font: 11px "SFMono-Regular",Consolas,"Liberation Mono",Menlo,Courier,monospace;
            display: inline-block;
            padding: 3px 5px;
            font-size: 11px;
            line-height: 10px;
            color: #444d56;
            vertical-align: middle;
            background-color: #fafbfc;
            border: solid 1px #c6cbd1;
            border-bottom-color: #959da5;
            border-radius: 3px;
            box-shadow: inset 0 -1px 0 #959da5;
        }
        hr {
            border-style: solid;
            border-top: 0;
            border-bottom: 1px solid #ccc;
        }

        #loadingIndicator[data-size="large"]::after {
            content: " this one is large";
        }

        /* Decide whether to move the following (all) to the html-table.css file */

        /* When the CSS is disabled then show a plain table with borders */
        .ps-table.ps-ui-disabled {
            width: 100%;
            background-color: white;
        }
        .ps-table.ps-ui-disabled td {
            border: 1px solid #ccc;
        }
        .ps-table.ps-ui-disabled caption {
            background-color: white;
        }

        /* When the CSS is disabled, still mark the player cell in bold */
        table.ps-table .ps-cell-label.ps-player {
            font-weight: bold;
        }

        #gamepadIcon:not(.enabled) {
            filter: grayscale(100%);
            opacity: .8;
        }

        /* Style the message dialog */
        dialog {
            border-radius: 6px;
            /* border: 1px solid rgba(0, 0, 0, 0.3); */
            /* box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3); */
        }

        label { cursor: pointer; }

        @media screen and (orientation:portrait) {
            #theGame {
                /* Ensure the game is always big */
                margin-top: 1rem;
                margin-bottom: 1rem;
            }
        }

        @media screen and (orientation:landscape) {
            #theGame {
                margin: auto;
            }
        }


        .ui-button,
        .ui-button-secondary {
            cursor: pointer;
            display: inline-block;
            text-decoration: none;
            padding: 0.5rem;
            border: 1px solid #666;
            border-radius: 6px;
            box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3);
        }
        .ui-button {
            color: white;
            background-color: rgba(90, 90, 238, 1);
        }
        .ui-button-secondary {
            color: black;
            background-color: white;
        }

        .ui-features-list {
            margin-bottom: 30px;
        }

        .ui-features-list li {
            margin-bottom: 1rem;
            position: relative;
        }

        .ui-features-list #useGamepad img {
            position: absolute;
            top: -15px;
        }

        .ui-features-list #useGamepad span {
            padding-left: 50px;
        }

        /* =================================================
         * FullScreen controls and styles 
         * =================================================
         */

        #fullscreenRoot { margin: auto; }


        #fullscreenButtons {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            display: flex;

            color: white;
            padding: 0.5rem;
            background-color: rgba(64, 64, 64, 0.5);
        }

        #fullscreenButtons #fullscreenGameInfo {
            flex: 1;
            display: inline-block;
            padding: 0.5rem;
        }
        #fullscreenButtons #fullscreenGameInfo a { color: white; }

        /* Make the background transparent in case the buttons cover the game */
        #fullscreenButtons .ui-button {
            background-color: rgba(90, 90, 238, 0.5);
        }
        #fullscreenButtons .ui-button:focus,
        #fullscreenButtons .ui-button:hover {
            background-color: rgba(90, 90, 238, 1);
        }
        #fullscreenButtons .ui-button-green {
            background-color: rgba(90, 238, 90, 0.5);
        }
        #fullscreenButtons .ui-button-green:focus,
        #fullscreenButtons .ui-button-green:hover {
            background-color: rgba(90, 238, 90, 1);
        }

        #disableCss { display: none; }


        #messageDialogClose {
            margin: 0.5rem;
        }

        body.is-background-dark #sourceCode,
        body.is-background-dark #gamepadSection {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
        }

        body:not(.is-background-dark) #sourceCode,
        body:not(.is-background-dark) #gamepadSection {
            background-color: rgba(255, 255, 255, 0.7);
            color: black;
        }

        #sourceCode,
        #gamepadSection {
            padding: .5rem;
            margin: .5rem;
            border-radius: 6px;
        }
        #sourceCode {
            position: fixed;
            bottom: 0;
            right: 0;
        }
        #gamepadSection {
            position: fixed;
            bottom: 0;
            left: 0;

            cursor: pointer;
        }

        #gamepadSection:not(:focus):not(:hover) #gamepadDescription {
            display: none;
        }


        /* *************************************
         * Browse Games Styling
         * ************************************/

        #browseGamesAbout { padding: 0 1rem; }

        figure {
            width: 150px;
            display: inline-block;
            margin: 1rem;

            /* look like a button */
            cursor: pointer;
            padding: 0.5rem;
            border: 1px solid #bbb;
            border-radius: 6px;
            box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3);
            vertical-align: top;
        }
        figcaption {
            min-height: 42px;
        }
        figcaption .game-title,
        figcaption .game-author {
            width: 150px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: center;
        }
        figcaption .game-title { color: black; font-weight: bold; line-height: 30px; }
        figcaption .game-author { font-size: 80%; color: #555; }
        .thumbnail-wrapper {
            width: 150px;
            height: 150px;
            /* vertically center the thumbnail */
            display: flex;
            flex-direction: column;
        }

        img.game-thumbnail {
            max-width: 100px;
            margin: auto;
            max-height: 100px;
        }

        .category-title { 
            /*sticky*/
            position: sticky;
            top: 0;
            left: 0;
            right: 0;
            display: block;
            z-index: 1;

            background: #333;
            color: #fff;
            padding: 10px 20px;
        }

        /* dialog-polyfill.css */
        dialog {
            position: absolute;
            left: 0; right: 0;
            width: -moz-fit-content;
            width: -webkit-fit-content;
            width: fit-content;
            height: -moz-fit-content;
            height: -webkit-fit-content;
            height: fit-content;
            margin: auto;
            padding: 1em;
            background: white;
            color: black;
            display: block;
        }
        dialog:not([open]) {
            display: none;
        }
        dialog + .backdrop {
            position: fixed;
            top: 0; right: 0; bottom: 0; left: 0;
            background: rgba(0,0,0,0.5);
        }
        ._dialog_overlay {
            position: fixed;
            top: 0; right: 0; bottom: 0; left: 0;
        }
        dialog.fixed {
            position: fixed;
            top: 50%;
            transform: translate(0, -50%);
        }
    </style>

    <meta charset="utf-8" />
    <meta name="description" content="Accessible Puzzle Videogames" />
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="preconnect" href="https://google-analytics.com" />
    <link rel="manifest" href="./pwa-manifest.json" />
    <link rel="preload" href="./puzzlescript-webworker.js" as="script" />
    <script src="./pwa-sw-loader.js" async="async"></script>

    <link rel="icon" type="image/x-icon" href="https://philschatz.com/puzzlescript/favicon.ico" />

    <meta property="og:title" content="Accessible PuzzleScript Games" />
    <meta property="og:url" content="https://philschatz.com/puzzlescript/" />
    <meta property="og:description" content="Play Accessible PuzzleScript video games in your browser or terminal." />
    <meta property="og:image" content="https://philschatz.com/puzzlescript/pwa-icon-512.png" />
    <meta property="og:site_name" content="Accessible PuzzleScript" />
    <meta property="og:type" content="object" />

    <meta property="twitter:card" name="twitter:card" content="summary" />
    <meta property="twitter:creator" name="twitter:creator" content="@philipschatz" />
    <meta property="twitter:description" name="twitter:description" content="Play Accessible PuzzleScript video games in your browser or terminal." />
    <meta property="twitter:image" name="twitter:image" content="https://philschatz.com/puzzlescript/pwa-icon-512.png" />
    <meta property="twitter:image:alt" name="twitter:image:alt" content="Video game controller icon" />
    <meta property="twitter:title" name="twitter:title" content="Accessible PuzzleScript games - Play them" />

    <!-- These need to be in the root and are generated via 
        declare -x ICON=180; inkscape -z -e $(pwd)/apple-touch-icon-_ICON_x_ICON_.png -w _ICON_ -h _ICON_ $(pwd)/pwa-icon.svg;
    -->
    <link rel="apple-touch-icon" sizes="57x57" href="apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="apple-touch-icon-72x72.png" />    
    <link rel="apple-touch-icon" sizes="76x76" href="apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="apple-touch-icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon-180x180.png" />
</head>

<body>
    
    <div id="playGameRoot">
        <div id="fullscreenRoot">   
            <table id="theGame" aria-labelledby="keyboardInstructionsSection">
                <caption>
                    Game info goes here. like the current level, the goal, etc.
                    <!-- See https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/ARIA_Live_Regions -->
                    <div role="log" aria-live="polite">The Game log</div>
                </caption>
            </table>
        </div>

        <div id="fullscreenButtons">
            <!-- needs to occur after the game so it appears on top of the game -->
            <div id="fullscreenTopLeftButtons">
                <a class="ui-button" href="#">Games</a>
                <button id="gameInstructionsButton2" class="ui-button">Help</button>
                <input id="disableCss" type="checkbox"/><label for="disableCss" class="ui-button ui-button-green" aria-hidden="true">Toggle UI</label>
            </div>
            <div id="fullscreenGameInfo">
                <span id="fullscreenTitle"></span> <span id="fullscreenPercentage"></span> : by <a id="authorInfo" target="_window"></a>
            </div>
            <div id="fullscreenTopRightButtons">
                <button id="gameButtonUndo" class="ui-button">Undo</button>
                <button id="gameButtonRestart" class="ui-button">Restart</button>
            </div>
        </div>

        <div id="gamepadSection" tabindex="0">
            <img id="gamepadIcon" alt="gamepad icon" width="40" height="40" src="./pwa-icon.svg"/>
            <span id="gamepadDescription">
                <span id="gamepadDisabled" class="hidden"><strong>Tip:</strong> Connect a gamepad controller (XBOX/PS3/PS4/etc) to use it to play.</span>
                <span id="gamepadRecognized" class="hidden">Gamepad is detected. You can play using it now. Just make sure the game is focused.</span>
                <span id="gamepadNotRecognized" class="hidden">Gamepad is detected but not recognized. Please submit an Issue on the Repository and we will help get it added</span>
            </span>
        </div>
        
    </div>

    <div id="browseGamesRoot">
        <div id="browseGamesAbout" class="ui-pwa-disabled">
            <div id="site-heading">
                <h1>Accessible Puzzle Games</h1>
                <p>Welcome to this PuzzleScript game library.</p>
                <p><a href="https://www.puzzlescript.net/" target="_window">PuzzleScript</a> games are a collection of open source, browser-friendly puzzle games. The engine for playing them has been rewritten to support accessibility features and make it easier to embed.</p>
                <p>With these enhancements hopefully more people can enjoy these delightful games.</p>
            </div>

            <h2>Features</h2>
    
            <ul class="ui-features-list">
                <li id="disableCssSection">When playing a game click <kbd>Toggle UI</kbd> to see what a non-sighted user would experience (disables CSS).</li>
                <li id="installOnMobile">Install as a mobile app by opening on a phone/tablet. It works offline. <button id="btnAdd" class="hidden ui-button">Add to Homescreen</button></li>
                <li id="iosInstallInstructions" class="hidden">For <strong>iOS users</strong>, click Share at the bottom, and then swipe over to <strong>Add to Home Screen</strong>. <a href="https://user-images.githubusercontent.com/253202/53995149-c5bc5800-40f9-11e9-9e54-3f6a0e10b857.gif" target="_window">Not finding it?</a></li>
                <li id="useGamepad"><img alt="gamepad icon" width="42" height="42" src="./pwa-icon.svg"/> <span>Plug in a Gamepad to play instead of using a keyboard or touch screen.</span></li>
            </ul>

            <p>Visit the <a href="https://github.com/philschatz/puzzlescript" target="_window">Source code on GitHub</a> for more information.</p>
        </div>

        <div id="browseGamesList"></div>
            
    </div>


    
    <a id="sourceCode" href="https://github.com/philschatz/puzzlescript" target="_window">Source Code</a>

    <dialog id="messageDialog">
        <p id="messageDialogText"></p>
        <button id="messageDialogClose" title="Close this window" class="ui-button">Close</button>
    </dialog>

    <dialog id="loadingDialog">
        <p id="loadingIndicator" data-size="small">Loading level...</p>
        <a id="loadingDialogCancel" title="Cancel loading the game" class="ui-button-secondary" href="#">Cancel</a>
    </dialog>
    
    <dialog id="gameInstructionsDialog">
        <div class="panel-header">
            <h2 class="panel-title">How to Play</h2>
        </div>
        
        <div id="keyboardInstructionsSection" class="ui-pwa-disabled">
            <p>To play with a keyboard:</p>
            <ul>
                <li>Arrow keys or <kbd>W</kbd>, <kbd>S</kbd>, <kbd>A</kbd>, <kbd>D</kbd> to move</li>
                <li><kbd>X</kbd> to perform an Action</li>
                <li><kbd>Z</kbd> or <kbd>U</kbd> for Undo</li>
                <li><kbd>R</kbd> to Restart the current level</li>
            </ul>
        </div>

        <div id="touchInstructionsSection" aria-hidden="true">
            <p>To play with a touch screen:</p>
            <ul>
                <li><strong>Swipe</strong> up, down, left, or right to move</li>
                <li><strong>Tap</strong> to perform an Action</li>
                <li><strong>Touch and Hold</strong> to Undo (Chrome)</li>
                <li><strong>Touch and Hold for a few seconds</strong> to Restart the current level (Chrome)</li>
            </ul>
        </div>
        
        <div id="gamepadSectionPWA" class="ui-pwa-only">
            <p>
                <img alt="gamepad icon" width="42" height="42" src="./pwa-icon.svg"/>
                <strong>Tip:</strong> Optionally, connect a gamepad controller (XBOX/PS3/PS4/etc) via BlueTooth to play games.
            </p>
            <p>
                Partial Gamepad support. Up/Down/Left/Right works but not Action/Undo. See this <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=906347">Chrome Bug</a>
            </p>
        </div>
    
        <button id="gameInstructionsDialogClose" title="Close" class="ui-button">Close</button>
        <button id="testShowNotificationButton" title="Show Browser Test Notification" class="ui-button-secondary">Test: Show Browser Notification</button>
    </dialog>

    <script type="text/javascript">//<![CDATA[
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-48498113-4', 'philschatz.com');
        ga('send', 'pageview');

        // Try to signal to Chrome that we are looking to use the real gamepad, not just up/down/left/right arrow keys mapped from a gamepad
        window.addEventListener("gamepadconnected", () => {})
        if (typeof navigator !== 'undefined' && navigator.getGamepads) {
            navigator.getGamepads()
        } else {
            setTimeout(() => {
                navigator.getGamepads()
            }, 1)
        }
    // ]]></script>
</body>

</html>